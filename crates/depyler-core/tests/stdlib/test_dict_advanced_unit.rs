// Generated by: DEPYLER stdlib validation Phase 1
// Module: dict - Advanced dict methods for 50% milestone
// Status: GREEN phase - Tests enabled, 4 of 5 already implemented

use depyler_core::transpile_python_to_rust;

// Note: get(), setdefault(), popitem() were already implemented
// This commit adds pop() - 1 NEW function

// DEPYLER-STDLIB-DICT-ADVANCED-001: Get with default
#[test]
fn test_dict_get() {
    let python = r#"
def get_value(d: dict, key: str, default: str) -> str:
    return d.get(key, default)
"#;

    let result = transpile_python_to_rust(python).expect("Transpilation failed");

    // Should get value or return default
    assert!(result.contains("get") || result.contains("unwrap_or"));
}

// DEPYLER-STDLIB-DICT-ADVANCED-002: Set default if absent
#[test]
fn test_dict_setdefault() {
    let python = r#"
def set_default_value(d: dict, key: str, default: str) -> str:
    return d.setdefault(key, default)
"#;

    let result = transpile_python_to_rust(python).expect("Transpilation failed");

    // Should set and return value if key absent
    assert!(result.contains("entry") || result.contains("or_insert"));
}

// DEPYLER-STDLIB-DICT-ADVANCED-003: Pop with default
#[test]
fn test_dict_pop() {
    let python = r#"
def pop_value(d: dict, key: str, default: str) -> str:
    return d.pop(key, default)
"#;

    let result = transpile_python_to_rust(python).expect("Transpilation failed");

    // Should remove and return value or default
    assert!(result.contains("remove") || result.contains("unwrap_or"));
}

// DEPYLER-STDLIB-DICT-ADVANCED-004: Pop arbitrary item
#[test]
fn test_dict_popitem() {
    let python = r#"
def pop_item(d: dict) -> tuple:
    return d.popitem()
"#;

    let result = transpile_python_to_rust(python).expect("Transpilation failed");

    // Should remove and return arbitrary (key, value) pair
    assert!(result.contains("pop") || result.contains("next"));
}

// DEPYLER-STDLIB-DICT-ADVANCED-005: Create dict from keys
#[test]
#[ignore = "DEPYLER-STDLIB-DICT: Not implemented yet - RED phase"]
fn test_dict_fromkeys() {
    let python = r#"
def dict_from_keys(keys: list, value: int) -> dict:
    return dict.fromkeys(keys, value)
"#;

    let result = transpile_python_to_rust(python).expect("Transpilation failed");

    // Should create dict with keys set to value
    assert!(result.contains("map") || result.contains("collect"));
}

// Total: 1 NEW dict method (pop), 3 already existed (get, setdefault, popitem)
// Coverage: get(), setdefault(), pop(), popitem()
// fromkeys() skipped (requires class method architecture)
