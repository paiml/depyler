# Depyler v3.14.0 Release Planning

**Date**: 2025-10-10
**Status**: Planning Phase
**Target Release**: TBD (4-6 weeks estimated)

## Executive Summary

Following the successful v3.13.0 release (Generator Expressions) and completion of the Technical Debt Sprint, v3.14.0 focuses on **transpiler correctness and code generation quality** based on validation findings.

**Strategic Direction**: Correctness > Features > Performance

## Recent Accomplishments (Since v3.13.0)

### ‚úÖ Technical Debt Sprint (COMPLETE)
- **Duration**: Single day (2025-10-10)
- **Effort**: ~15 hours (vs ~300h estimated, 95% efficiency gain)
- **Hotspots Resolved**: 5/5 (100%)
  - HirStmt::to_rust_tokens: 129 ‚Üí <10
  - HirFunction::to_rust_tokens: 106 ‚Üí 8
  - convert_method_call: 99 ‚Üí <10
  - rust_type_to_syn_type: 73 ‚Üí <10
  - apply_annotations Phase 1: 69 ‚Üí 22 (-68%)
- **SATD Cleanup**: 4 ‚Üí 0 production code violations
- **Coverage**: Verified working via `make coverage`
- **Tests**: 393 passing (100% maintained)
- **Quality**: A+ standards achieved

### ‚úÖ Example Validation Infrastructure (COMPLETE)
- **Script**: `scripts/validate_examples.sh` with 5 quality gates
- **Baseline**: 67% showcase examples passing (4/6)
- **Bugs Found**: 3 critical transpiler issues discovered
- **Impact**: Clear priorities for v3.14.0

## Validation Findings (Critical Input for v3.14.0)

### Passing Examples (4/6 = 67%)
- binary_search.rs ‚úÖ
- calculate_sum.rs ‚úÖ
- classify_number.rs ‚úÖ
- process_config.rs ‚úÖ

**Shared Quality Issues**:
1. Unnecessary parentheses: `(0) as i32`
2. Extra spaces in lifetimes: `& 'a Vec<i32>`
3. Unclear CSE names: `_cse_temp_0`
4. Complex codegen (floor division: 15+ lines)

### Failing Examples (2/6 = 33%)
- annotated_example.rs ‚ùå - Transpiler error, not code
- contracts_example.rs ‚ùå - Multiple type bugs

### Critical Transpiler Bugs Discovered

#### **DEPYLER-0148**: Dict Item Augmented Assignment ‚ùå (P1)
**Issue**: `word_count[word] += 1` fails with "Augmented assignment not supported"
**Impact**: Blocks annotated_example showcase, common Python pattern
**Effort**: ~8-12 hours
**Priority**: **P1 - HIGH** (correctness issue, affects real code)

#### **DEPYLER-0149**: Type Generation Bugs ‚ùå (P0)
**Issues**:
- Generates `list<T>` instead of `Vec<T>`
- Invalid `int()` function calls
- Type inconsistencies (usize vs i32 mixing)
**Impact**: Blocks contracts_example showcase, generates invalid Rust
**Effort**: ~12-16 hours
**Priority**: **P0 - CRITICAL** (generates non-compiling code)

#### **DEPYLER-0150**: Code Generation Quality ‚ö†Ô∏è (P2)
**Issues**:
- Unnecessary parentheses around literals
- Extra spaces in type annotations
- Overly complex code for simple operations
**Impact**: Quality issue, not correctness (code compiles but ugly)
**Effort**: ~4-8 hours
**Priority**: **P2 - MEDIUM** (polish, not blocking)

## v3.14.0 Goals

### Primary Goal: **Transpiler Correctness** üéØ
Achieve 100% showcase example compilation rate with zero transpiler bugs.

### Secondary Goal: **Code Generation Quality** ‚öôÔ∏è
Generate idiomatic, clean Rust code that meets all quality gates.

### Tertiary Goal: **Feature Expansion** üöÄ
Add support for high-impact Python features (if time permits).

## v3.14.0 Proposed Priorities

### Phase 1: Critical Correctness (P0) - Week 1
**Goal**: Fix bugs that generate invalid Rust code

1. **DEPYLER-0149**: Type Generation Fixes
   - Replace `list<T>` ‚Üí `Vec<T>` in type mapper
   - Remove invalid `int()` function generation
   - Fix type consistency (usize/i32 mixing)
   - **Success Criteria**: contracts_example.rs compiles
   - **Tests**: Add 10+ unit tests for type generation
   - **Effort**: 12-16 hours

### Phase 2: High-Impact Correctness (P1) - Week 2
**Goal**: Support common Python patterns that currently fail

2. **DEPYLER-0148**: Dict/List Item Augmented Assignment
   - Support `d[k] += 1`, `arr[i] *= 2`, etc.
   - Transpile to `*d.get_mut(k).unwrap() += 1`
   - **Success Criteria**: annotated_example.py transpiles successfully
   - **Tests**: Add 15+ tests for augmented assignment patterns
   - **Effort**: 8-12 hours

### Phase 3: Code Quality (P2) - Week 3
**Goal**: Generate clean, idiomatic Rust code

3. **DEPYLER-0150**: Code Generation Quality Improvements
   - Remove unnecessary parentheses
   - Fix type annotation spacing
   - Simplify complex generated code (floor division)
   - Improve CSE variable naming
   - **Success Criteria**: All showcase examples pass clippy with zero warnings
   - **Tests**: Golden file tests for code quality
   - **Effort**: 4-8 hours

### Phase 4: Re-validation (P0) - Week 3
**Goal**: Verify all fixes work end-to-end

4. **Re-transpile All Showcase Examples**
   - Regenerate all 6 showcase examples with fixed transpiler
   - Run full validation suite
   - Document improvements
   - **Success Criteria**: 6/6 showcase examples pass all quality gates
   - **Effort**: 2-4 hours

### Phase 5 (Optional): Feature Expansion - Week 4-6
**Goal**: Add high-impact Python features (if Phases 1-4 complete early)

5. **DEPYLER-0117**: Async/Await Support (P2)
   - Python `async def` ‚Üí Rust `async fn`
   - `await expr` ‚Üí `.await`
   - **Impact**: Blocks 8% of example failures
   - **Effort**: 20-30 hours

6. **DEPYLER-0118**: With Statement/Context Managers (P2)
   - Python `with open() as f:` ‚Üí Rust RAII
   - **Impact**: Blocks 6% of example failures
   - **Effort**: 15-20 hours

## Success Criteria for v3.14.0

### Must Have (P0) ‚úÖ
- [ ] All 6 showcase examples compile successfully (currently 4/6)
- [ ] Zero transpiler bugs that generate invalid Rust
- [ ] Type generation produces valid Rust types
- [ ] 393+ tests passing (maintain 100% pass rate)
- [ ] Zero clippy warnings on generated code

### Should Have (P1) ‚öôÔ∏è
- [ ] Dict/list item augmented assignment supported
- [ ] Common Python patterns transpile successfully
- [ ] 80%+ test coverage maintained
- [ ] Zero SATD in production code

### Nice to Have (P2) üé®
- [ ] Clean, idiomatic generated code (no unnecessary parens/spaces)
- [ ] Simplified codegen for common operations
- [ ] Better CSE variable naming
- [ ] 1-2 new language features (async/await or with statements)

## Testing Strategy

### Regression Testing
- Maintain 393+ passing tests throughout development
- Add tests BEFORE fixing each bug (TDD)
- Run full test suite after each change

### New Tests Required
- **Type Generation**: 10+ tests for Vec, Option, Result, tuple mappings
- **Augmented Assignment**: 15+ tests for dict/list item augmented ops
- **Code Quality**: Golden file tests comparing generated vs expected

### Validation Testing
- Re-run `scripts/validate_examples.sh` after each fix
- Document improvement metrics (4/6 ‚Üí 5/6 ‚Üí 6/6)
- Validate on additional example directories (algorithms, data_structures)

## Risk Assessment

### Low Risk ‚úÖ
- **Technical Debt Sprint**: Proven Extract Method pattern, completed successfully
- **Testing Infrastructure**: 393 tests provide safety net
- **Validation Infrastructure**: Can measure progress objectively

### Medium Risk ‚ö†Ô∏è
- **Type System Changes**: Could affect existing working code (mitigation: comprehensive tests)
- **Code Generation Changes**: Formatting changes might break existing workflows (mitigation: maintain backwards compatibility option)

### High Risk ‚ùå
- **Schedule Slip**: Async/await could take longer than estimated (mitigation: make Phase 5 optional)
- **Scope Creep**: More bugs might be discovered (mitigation: strict P0/P1/P2 prioritization)

## Timeline Estimate

**Conservative Estimate** (4-6 weeks):
- Week 1: Phase 1 (Type Generation Fixes)
- Week 2: Phase 2 (Augmented Assignment)
- Week 3: Phase 3 (Code Quality) + Phase 4 (Re-validation)
- Week 4-6: Phase 5 (Optional Features) OR buffer for unexpected issues

**Optimistic Estimate** (2-3 weeks):
- Week 1: Phases 1-2 (Correctness fixes)
- Week 2: Phases 3-4 (Quality + Validation)
- Week 3: Release prep

## Metrics to Track

### Quantitative
- Showcase examples passing: 4/6 ‚Üí 6/6 (target: 100%)
- Test count: 393 ‚Üí 420+ (add ~27 new tests)
- Test coverage: Maintain 80%+
- Clippy warnings on generated code: ? ‚Üí 0 (target: zero)
- SATD: 0 ‚Üí 0 (maintain zero)

### Qualitative
- Generated code quality: "Compiles but ugly" ‚Üí "Idiomatic Rust"
- Transpiler reliability: "67% success rate" ‚Üí "100% success rate"
- Developer confidence: "Needs manual fixes" ‚Üí "Transpiles correctly first time"

## v3.14.0 Release Checklist

### Pre-Release
- [ ] All P0 tickets complete (DEPYLER-0149)
- [ ] All P1 tickets complete (DEPYLER-0148)
- [ ] 6/6 showcase examples passing
- [ ] 420+ tests passing
- [ ] Zero SATD in production code
- [ ] CHANGELOG.md updated
- [ ] Roadmap updated with completion status

### Release
- [ ] Tag release: `git tag v3.14.0`
- [ ] Push tag: `git push origin v3.14.0`
- [ ] Update version in Cargo.toml
- [ ] Publish release notes

### Post-Release
- [ ] Re-transpile all examples with v3.14.0
- [ ] Run full validation suite on all example directories
- [ ] Document known limitations
- [ ] Plan v3.15.0 priorities

## Key Decisions Needed

1. **Phase 5 Inclusion**: Should we include async/await in v3.14.0, or defer to v3.15.0?
   - **Recommendation**: Defer to v3.15.0 - focus v3.14.0 on correctness

2. **Breaking Changes**: Can we make breaking changes to code generation?
   - **Recommendation**: Yes, but provide migration guide

3. **Validation Scope**: Should we validate all ~150 examples, or just showcase?
   - **Recommendation**: Showcase for v3.14.0, expand to all in v3.15.0

## Comparison to v3.13.0

| Metric | v3.13.0 | v3.14.0 Target | Change |
|--------|---------|----------------|--------|
| Tests | 393 | 420+ | +27 (+7%) |
| Showcase Passing | ? | 6/6 (100%) | N/A |
| SATD | 0 | 0 | Maintain |
| Complexity | Top 5 resolved | Maintain | Maintain |
| Features | Generator Expressions | Dict Augmented Assignment | +1 |

## Conclusion

v3.14.0 focuses on **correctness over features**, addressing 3 critical transpiler bugs discovered through systematic validation. By fixing type generation and supporting common Python patterns, we aim for 100% showcase example compilation rate and establish Depyler as a reliable Python‚ÜíRust transpiler.

**Core Philosophy**: Ship correct code first, add features second.

---

**Document Status**: Draft
**Next Review**: After roadmap update
**Owner**: Depyler Core Team
**Last Updated**: 2025-10-10
