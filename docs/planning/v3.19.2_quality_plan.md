# v3.19.2 Quality Improvement Plan - Reduce Complexity Violations

**Goal**: Reduce legacy complexity violations from 57 to ≤40
**Approach**: Incremental Kaizen on highest complexity functions
**Duration**: 6-8 hours
**Target**: Reduce 17+ violations (30% reduction)

## Current Complexity Status

**Total Violations**: 57 functions with complexity >10
**Distribution**:
- expr_gen.rs: 44 violations (~370 hours estimated)
- stmt_gen.rs: 11 violations (~60 hours estimated)  
- func_gen.rs: 2 violations (~51 hours estimated)

**Total Estimated Effort**: 482 hours (if all done at once)
**v3.19.2 Scope**: 6-8 hours (1-2% of total, strategic picks)

## Strategy: "Low-Hanging Fruit" Approach

Focus on violations that are:
1. **Close to threshold** (complexity 11-15, not 50+)
2. **High usage** (called frequently in codebase)
3. **Clear refactoring path** (obvious extract method opportunities)

## Target Functions (Prioritized)

### Priority 1: stmt_gen.rs (Easiest Wins)

**Current**: 11 violations
**Target**: 5-6 violations
**Effort**: 3-4 hours

1. **codegen_for_stmt** (complexity ~15)
   - Issue: Nested loop handling
   - Solution: Extract `codegen_loop_target`, `codegen_loop_body`
   - Effort: 1h
   - Expected: 15 → 8

2. **codegen_try_stmt** (complexity ~13)
   - Issue: Exception handler branching
   - Solution: Extract `codegen_exception_handler`, `codegen_finally_block`
   - Effort: 45min
   - Expected: 13 → 9

3. **codegen_with_stmt** (complexity ~12)
   - Issue: Context manager setup/teardown
   - Solution: Extract `codegen_context_enter`, `codegen_context_exit`
   - Effort: 30min
   - Expected: 12 → 8

**stmt_gen.rs Progress**: 11 → 5-6 violations (-45% to -55%)

### Priority 2: func_gen.rs (Strategic Picks)

**Current**: 2 violations
**Target**: 0 violations ✅
**Effort**: 2-3 hours

1. **codegen_generic_constraints** (complexity ~15)
   - Issue: Generic bound checking
   - Solution: Extract `validate_trait_bound`, `format_where_clause`
   - Effort: 1.5h
   - Expected: 15 → 9

2. **codegen_lifetime_annotations** (complexity ~12)
   - Issue: Lifetime elision rules
   - Solution: Extract `infer_lifetime`, `apply_lifetime_rules`
   - Effort: 1h
   - Expected: 12 → 8

**func_gen.rs Progress**: 2 → 0 violations (-100%) ✅

### Priority 3: expr_gen.rs (Defer Most, Pick 1-2)

**Current**: 44 violations
**Target**: 42 violations
**Effort**: 1-2 hours

**Note**: expr_gen.rs has many complex violations (complexity 20-50+). 
Most require 4-8 hours each. Pick only the easiest 1-2.

1. **convert_dict_comprehension** (complexity ~12)
   - Issue: Dict comprehension with filters
   - Solution: Extract `generate_dict_entry`, `apply_dict_filter`
   - Effort: 1h
   - Expected: 12 → 9

2. **convert_set_comprehension** (complexity ~11)
   - Issue: Set comprehension edge cases
   - Solution: Extract `generate_set_element`, `apply_set_filter`
   - Effort: 45min
   - Expected: 11 → 8

**expr_gen.rs Progress**: 44 → 42 violations (-4.5%)

## Total v3.19.2 Impact

- **Violations Before**: 57
- **Violations After**: 40-41
- **Reduction**: 16-17 violations (**28-30% improvement**)
- **Effort**: 6-8 hours
- **Efficiency**: ~2.5 violations per hour

## Success Criteria

✅ Complexity violations: 57 → ≤41 (at least 28% reduction)
✅ All refactored functions ≤10 complexity
✅ All tests passing (zero regressions)
✅ Zero clippy warnings
✅ SATD = 0 maintained
✅ Performance: No regressions (use #[inline])

## Toyota Way Alignment

- **Kaizen**: Incremental improvement (16-17 violations, not all 57)
- **Jidoka**: Stop and verify after each refactoring
- **Genchi Genbutsu**: Measure complexity after each change
- **Hansei**: Reflect on which refactorings provided most value

## Deliverables

1. **Refactored Functions**: 7-8 functions with complexity ≤10
2. **Test Coverage**: Maintain or improve (no coverage loss)
3. **Documentation**: Update complexity tracking in roadmap
4. **Commit Messages**: Each refactoring documented with before/after metrics
