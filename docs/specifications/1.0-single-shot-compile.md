# 1.0 Single-Shot Compile Specification: The Unified Standard

**Version**: 3.6.0 (crates.io v3.23.0 release + E0282 fix)
**Date**: 2026-01-26
**Status**: **ğŸ”§ ACTIVE â€” 7pp from 80% target**
**Authors**: Depyler Team

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Active Phase: 6d](#2-active-phase-6d)
3. [Architecture Overview](#3-architecture-overview)
4. [Structural Typing Solutions](#4-structural-typing-solutions)
5. [Performance Infrastructure](#5-performance-infrastructure)
6. [Sovereign Type Database](#6-sovereign-type-database)
7. [Falsification Framework](#7-falsification-framework)
8. [Epistemic Health Metrics (DEPYLER-1322)](#8-epistemic-health-metrics-depyler-1322)
9. [ML Infrastructure Activation (DEPYLER-1328)](#9-ml-infrastructure-activation-depyler-1328)
- [Appendix D: Phase 6 Empirical Findings](#appendix-d-phase-6-empirical-findings)
- [Appendix E: Claude Sub-Agent Architecture](#appendix-e-claude-sub-agent-architecture)
- [Appendix F: Falsification Record](#appendix-f-falsification-record)
- [Appendix G: Oracle User Training (DEPYLER-ORACLE-TRAIN)](#appendix-g-oracle-user-training-depyler-oracle-train)

**Archives** (historical details moved to reduce spec size):
- [`1.0-single-shot-compile-archive/completed-tickets.md`](./1.0-single-shot-compile-archive/completed-tickets.md) â€” 146+ resolved DEPYLER tickets
- [`1.0-single-shot-compile-archive/root-cause-analyses.md`](./1.0-single-shot-compile-archive/root-cause-analyses.md) â€” Five-Whys investigations
- [`1.0-single-shot-compile-archive/falsifier-checklist.md`](./1.0-single-shot-compile-archive/falsifier-checklist.md) â€” 100-point Popper strategy

---

## 1. Executive Summary

### Vision
Enable Python developers to compile **ANY** Python script to a highly optimized, type-safe Rust binary with a single command.

```bash
depyler compile my_script.py --release
# Result: ./my_script (native binary, 10-50x faster)
```

### Current Status (Jan 26, 2026) â€” POST v3.23.0 RELEASE

| Metric | Semantic Tests | Full Examples | Notes |
|--------|----------------|---------------|-------|
| **Files** | 178 semantic_test_* | 318 examples/* | Full corpus |
| **TRUE Success Rate** | 100% | **73.6%** | After E0282 fix |
| **Successes** | 178 | **234** | crates.io v3.23.0 |
| **Failures** | 0 | **84** | Down from 85 |
| **Target** | 80% | 80% | **22 files to go** |
| **Oracle Training** | âœ… | âœ… | User corpus learning enabled |
| **crates.io** | v3.23.0 | v3.23.0 | All 10 crates published |

```
Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 73.6%
Target:   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 80%
Gap:      22 files needed (256/318 = 80%)
```

### New in v3.5.0: Oracle User Training

The Oracle now learns from YOUR corpus. See [Appendix G](#appendix-g-oracle-user-training-depyler-oracle-train).

```bash
# Train on your project
depyler train --corpus ./my_project

# Run demo
cargo run --example oracle_user_training -p depyler-oracle
```

### âš ï¸ FALSIFICATION NOTICE (Jan 26, 2026)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   INDEPENDENT AUDIT RESULTS                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                   â•‘
â•‘   The 100% claim has been FALSIFIED.                              â•‘
â•‘                                                                   â•‘
â•‘   The "100% success" was measured on a curated test corpus        â•‘
â•‘   (semantic_test_* files) designed to work within known           â•‘
â•‘   transpiler limitations â€” NOT the real corpus.                   â•‘
â•‘                                                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                   REAL CORPUS RESULTS                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   Corpus:        178 files (full manifest)                        â•‘
â•‘   Successes:     62 files                                         â•‘
â•‘   Failures:      116 files                                        â•‘
â•‘   TRUE Success:  34.83%                                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 34.83%     â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 80% target â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Failure Breakdown (Real Corpus)

| Category | Count | % of Failures |
|----------|-------|---------------|
| **COMPILE_FAIL** | 108 | 93% |
| **SEMANTIC_MISMATCH** | 6 | 5% |
| **TRANSPILE_FAIL** | 2 | 2% |

### Compiler Error Distribution (POST v3.23.0)

| Error Code | Description | Count | % of Total |
|------------|-------------|-------|------------|
| **E0308** | Type mismatch (complex inference) | 34 | 50% |
| **E0599** | Method not found | 13 | 19% |
| **E0433/E0432** | Unresolved imports (external deps) | 11 | 16% |
| **E0277** | Trait not implemented | 7 | 10% |
| **E0282** | Type annotations needed | 3 | 4% |

**Key Finding**: E0308 remains the #1 blocker at 50% of remaining errors.
Root cause: Lists typed as `Vec<DepylerValue>` but functions expect concrete types like `i32`.

**Previous Distribution** (pre-TYPE SURGEON):
| E0308: 349 (38%) | E0599: 152 (17%) | E0425: 119 (13%) | E0277: 109 (12%) | E0282: 97 (11%) |

**Progress**: Total errors reduced from ~920 to ~68 (93% reduction).

### Categories That Fail

The transpiler **cannot yet handle**:
1. **Async/Await** â€” `golden_async_concurrency.py`, `test_async.py`
2. **Complex Stdlib** â€” `test_datetime_module.py`, `test_itertools.py`
3. **Decorators** â€” `test_function_decorators.py`
4. **Context Managers** â€” `test_with_statement.py`
5. **Complex Type Inference** â€” `showcase_type_inference.py`

### Recent Fixes (OPERATION CLASS ACTION + ORACLE TRAIN + v3.23.0)

| Ticket | File | Issue | Fix | Status |
|--------|------|-------|-----|--------|
| **DEPYLER-CLASS-001** | `basic_class_test.py` | Operator precedence in class methods | `parenthesize_if_lower_precedence()` at direct_rules_convert.rs:2128-2132 | âœ… FIXED |
| **DEPYLER-ORACLE-TRAIN** | Multiple | Oracle was read-only | Wired feedback loop in converge | âœ… IMPLEMENTED |
| **v3.23.0** | All crates | crates.io release | Published 10 crates | âœ… RELEASED |
| **E0282-CHAIN** | expr_gen.rs | Chained PyOps in returns | Added type annotations for chained expressions | âœ… FIXED |

**crates.io v3.23.0 Release**:
- depyler-knowledge, depyler-core, depyler-analyzer, depyler-verify
- depyler-mcp, depyler-annotations, depyler-quality, depyler-graph
- depyler-oracle, depyler (main CLI)

**Bug Details (CLASS-001)**: Class method bodies didn't preserve operator precedence.
- `2 * (self.width + self.height)` â†’ `2 * self.width + self.height` (WRONG)
- Fixed: Now correctly generates `2 * (self.width.clone() + self.height.clone())`

**Bug Details (E0282-CHAIN)**: Chained PyOps expressions in return statements lacked type annotations.
- E0282 count reduced from 97 â†’ 3

**Feature (ORACLE-TRAIN)**: Oracle can now learn from user corpus.
- Added `save()`/`load()` to `NgramFixPredictor` (ngram.rs:321-365)
- Added `ErrorCategory::from_code()` for error classification (classifier.rs)
- Wired feedback recording in converge loop (converge/mod.rs)
- Added `Train` CLI command (lib.rs, main.rs)
- Model persists to `~/.depyler/oracle_user.bin`

### OPERATION STDLIB STRIKE (Hypothesis Falsified)

**Original Hypothesis**: "Missing stdlib is the main blocker" (93% of failures are compile errors, many from E0425/E0433)

**Finding**: PARTIALLY FALSIFIED

| Root Cause | Errors | Impact |
|------------|--------|--------|
| Type inference (E0308+E0282) | 446 | 49% |
| Method/Trait resolution (E0599+E0277) | 261 | 28% |
| Unresolved names (E0425) | 119 | 13% |
| Unresolved modules (E0433) | 93 | 10% |

**Additional Finding**: Crate mappings exist but verification uses wrong tool.
- Files generate `Cargo.toml` with correct dependencies
- `verify_absolute_truth.py` uses `rustc` directly instead of `cargo build`
- With `cargo build`, E0433 errors resolve but E0308/E0277 remain

**Pivot**: Focus on type inference improvements, not stdlib mapping.

### OPERATION TYPE SURGEON (Ongoing)

**Objective**: Fix E0308 type mismatches â€” the #1 blocker at 50% of remaining errors.

| Ticket | Issue | Fix | Files Modified | Status |
|--------|-------|-----|----------------|--------|
| **DEPYLER-E0308-002** | Heterogeneous dict inference | Detect mixed-type values, use DepylerValue | `type_hints.rs`, `type_tokens.rs` | âœ… FIXED |
| **E0282-CHAIN** | Chained PyOps returns | Add type annotations | `expr_gen.rs` | âœ… FIXED |

**Results**:
- Full examples corpus: 62/178 (34.83%) â†’ **234/318 (73.6%)**
- Gained **+172 files** from type inference fixes
- Remaining errors: E0308 (34), E0599 (13), E0433/E0432 (11), E0277 (7), E0282 (3)

**Next Blocker**: List type propagation
- Lists typed as `Vec<DepylerValue>` but functions expect concrete types like `i32`
- Need to propagate type annotations through list construction

**Files Modified**:
- `crates/depyler-core/src/type_hints.rs` â€” Fixed `infer_dict_type` to detect heterogeneous values
- `crates/depyler-core/src/rust_gen/type_tokens.rs` â€” Fixed `Any` type mapping to use `DepylerValue`
- `crates/depyler-core/src/rust_gen/expr_gen.rs` â€” E0282 fix for chained PyOps expressions

### Honest Assessment

| Metric | Curated Corpus | Real Corpus |
|--------|----------------|-------------|
| Files | 178 semantic_test_* | 178 full manifest |
| Success Rate | 100% | 34.83% |
| Domain | Simple typed functions | Real Python programs |

**The transpiler is effective for**: simple, fully-typed, pure functions without classes, async, or complex stdlib usage.

**The transpiler fails on**: real-world Python code with OOP, async, decorators, context managers, and complex standard library usage.

### Curated Corpus Results (semantic_test_* files)

The following results are valid for the **curated test corpus only**:

| Level | Files | Pass Rate |
|-------|-------|-----------|
| **1: Pure Functions** | add, subtract, multiply, divide, etc. | 22/22 (100%) |
| **2: String Ops** | concat, repeat, upper, lower, etc. | 20/20 (100%) |
| **3: List Ops** | sum, indexing, length, slice, etc. | 23/23 (100%) |
| **4: Dict Ops** | create, len, membership, iteration | 5/5 (100%) |
| **5: Tuple Ops** | create, index, unpack, tuple_len | 4/4 (100%) |
| **6: Control Flow** | if_else, for_loop, while_loop, etc. | 12/12 (100%) |
| **7: Boolean** | and_or, not_op, eq, lt, etc. | 12/12 (100%) |
| **8: Builtins** | max_min, sum_list, int_max, int_min | 4/4 (100%) |
| **9: Algorithms** | gcd, lcm, is_prime, binary_search, etc. | 15/15 (100%) |
| **10: Counting** | count_positive, count_negative, etc. | 6/6 (100%) |
| **11: Aggregation** | alternate_sum, difference, pair_sum | 4/4 (100%) |
| **12: Advanced** | ternary, function_composition, etc. | 8/8 (100%) |

**Important**: These results demonstrate capability within a constrained domain, not general Python transpilation.

### Path Forward

The next task is to **expand capability**, not celebrate false victories:

1. **OOP Support** â€” Classes, inheritance, methods
2. **Async/Await** â€” Coroutines, async iterators
3. **Decorators** â€” Function and class decorators
4. **Context Managers** â€” `with` statement support
5. **Complex Stdlib** â€” datetime, itertools, collections

### Remaining Blockers (Active)

| Ticket | Issue | Root Cause | Status |
|--------|-------|------------|--------|
| DEPYLER-1370 | Classes/OOP | No class transpilation | ğŸ”´ BLOCKING |
| DEPYLER-1371 | Async/Await | No async support | ğŸ”´ BLOCKING |
| DEPYLER-1372 | Decorators | No decorator support | ğŸ”´ BLOCKING |
| DEPYLER-1373 | Context Managers | No `with` support | ğŸ”´ BLOCKING |
| DEPYLER-1362 | Wrong statistics | Requires math.sqrt() | â¸ï¸ Deferred |
| DEPYLER-1363 | Random differs | Requires seeded RNG | â¸ï¸ Deferred |

---

## 2. OPERATION SEMANTIC TRUTH: The Falsification

> **PARADIGM SHIFT**: We redefined success around semantic correctnessâ€”Python output must match Rust output byte-for-byte. The methodology was correct. The error was **measuring success on a curated corpus instead of the real corpus**. This section documents both the methodology and the falsification that corrected our overconfident claims.

### 2.0 The Falsification Event (Jan 26, 2026)

**What Happened**: The "100% TRUE Success Rate" was measured on 178 `semantic_test_*.py` files that were specifically designed to work within known transpiler limitations. An independent audit against the real corpus (178 files from the full manifest) revealed the true success rate: **34.83%**.

**Why This Matters**: Per Karl Popper, "100% success often indicates that the domain of testing is too small, not that the theory is perfect." The curated corpus achieved 100% by avoiding unsupported featuresâ€”classes, async, decorators, context managers, and complex stdlib usage.

**The Lesson**: Always measure against representative real-world data, not curated test cases.

### 2.0 The New Priority Stack

```
OLD PRIORITY (WRONG):           NEW PRIORITY (CORRECT):
1. Compile more files           1. Fix semantic parity on compiling files
2. Reduce E0425/E0308          2. Then compile more files
3. Test semantic parity         3. Validate each new compilation
```

**Falsification Insight**: A transpiler that compiles 100% of files but produces wrong output is **worse than useless**â€”it creates false confidence.

---

### 2.0.1 PHASE 0: SEMANTIC REPAIR âœ… COMPLETE

**Goal**: Achieve â‰¥1 file with TRUE success (compiles AND matches Python output)

| Ticket | Task | Status |
|--------|------|--------|
| **DEPYLER-1361** | Root cause the 3 semantic failures | âœ… COMPLETE |
| DEPYLER-1362 | Fix numerical precision (statistical functions) | ğŸ“‹ TODO |
| DEPYLER-1363 | Fix random state handling | ğŸ“‹ TODO |
| DEPYLER-1364 | Investigate remaining failures | ğŸ“‹ TODO |

**Exit Criteria**: ~~At least ONE file with `python foo.py == ./foo` output match~~ âœ… **ACHIEVED: 4 FILES**

**Result**: Architecture NOT falsified. Simple cases (integer math, string concat, list iteration) achieve semantic parity. Complex cases (statistics, RNG) have identified root causes.

---

### 2.1 Error Distribution Analysis

```
Total Errors: 2,804

E0425 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 53% (1,487)
E0423 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 18% (504)
E0599 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  7% (197)
E0308 â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  3% (95)
E0282 â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2% (60)
Other â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 17% (461)
```

**Key Insight**: E0425 + E0423 = **71%** of all errors. Fix these first.

---

### 2.2 Phased Attack Plan

#### PHASE 1: IDENTIFIER BLITZ (GH-204) â€” Week 1
**Goal**: E0425 < 500, E0423 < 100

| Ticket | Task | Owner | Status |
|--------|------|-------|--------|
| **GH-204** | Resolve E0425/E0423 identifiers | Team | ğŸ”„ IN PROGRESS |
| GH-204a | Audit top 50 unresolved identifiers | - | ğŸ“‹ TODO |
| GH-204b | Add missing stdlib module stubs | - | ğŸ“‹ TODO |
| GH-204c | Fix struct/enum constructor patterns | - | ğŸ“‹ TODO |

**Commands**:
```bash
# Find top unresolved identifiers
cargo run --bin depyler -- converge --corpus examples/ 2>&1 | \
  grep "E0425\|E0423" | sed 's/.*`\([^`]*\)`.*/\1/' | sort | uniq -c | sort -rn | head -30
```

**Falsification**: If E0425+E0423 don't drop by â‰¥50% after this phase, the stub generation approach is falsified.

---

#### PHASE 2: METHOD COMPLETION (DEPYLER-1350) â€” Week 2
**Goal**: E0599 < 50

| Ticket | Task | Status |
|--------|------|--------|
| **DEPYLER-1350** | E0599 Method Stub Generation | ğŸ“‹ TODO |
| DEPYLER-1351 | Extend PyOps traits for Vec/HashMap methods | ğŸ“‹ TODO |
| DEPYLER-1352 | Add DepylerValue method forwarding | ğŸ“‹ TODO |

**Pattern**: Most E0599 are missing `.iter()`, `.len()`, `.keys()`, `.values()` on generated types.

---

#### PHASE 3: TYPE COERCION (DEPYLER-1329) â€” Week 3
**Goal**: E0308 < 30

| Ticket | Task | Status |
|--------|------|--------|
| **DEPYLER-1329** | Wire CITL Pattern Store | ğŸ“‹ TODO |
| DEPYLER-1353 | Extract fix patterns from 146 resolved tickets | ğŸ“‹ TODO |
| DEPYLER-1354 | Auto-apply historical fixes for E0308 | ğŸ“‹ TODO |

**New Capability**: Use ML to suggest fixes based on past solutions.

---

#### PHASE 4: ANNOTATION INFERENCE (DEPYLER-1355) â€” Week 4
**Goal**: E0282 < 20

| Ticket | Task | Status |
|--------|------|--------|
| **DEPYLER-1355** | Type annotation inference from context | ğŸ“‹ TODO |
| DEPYLER-1356 | Propagate types from function signatures | ğŸ“‹ TODO |

---

### 2.3 NEW CAPABILITIES (Paradigm Shift)

These are capabilities that **have not been tried** and may break the 40% barrier:

#### Capability 1: CITL Pattern Store (DEPYLER-1329)
**What**: RAG-based fix suggestions from historical patterns.
**Why New**: Infrastructure exists in `entrenar` but is not wired to Oracle.
**Impact**: Could auto-fix 30-50% of remaining E0308 errors.

```rust
// Wire this in Oracle prediction loop
let similar = pattern_store.find_similar(&error_embedding, k=5);
if let Some(fix) = similar.first().and_then(|p| p.fix_suggestion.as_ref()) {
    apply_fix(fix);
}
```

#### Capability 2: Corpus Tier Classification (DEPYLER-1327)
**What**: Split corpus into Typed (Tier 1) vs Untyped (Tier 2) Python.
**Why New**: Currently measuring both together, hiding true success rate.
**Impact**: Tier 1 (annotated Python) should hit 80%+. Tier 2 has lower ceiling.

```bash
# Classify corpus
python scripts/classify_corpus.py --corpus examples/ --output corpus_tiers.json
```

#### Capability 3: Differential Testing (DEPYLER-1324)
**What**: Verify compiled Rust produces same output as Python.
**Why New**: Current 16% may include semantic regressions.
**Impact**: True success rate = Compile Rate Ã— Semantic Parity.

#### Capability 4: Claude Sub-Agent Escalation (DEPYLER-1336)
**What**: Escalate low-confidence Oracle predictions to Claude API.
**Why New**: Human-level reasoning on novel error patterns.
**Impact**: Est. +20% fix rate on hard cases.

---

### 2.4 Success Milestones

| Week | Target | Errors | Compile Rate | Gate |
|------|--------|--------|--------------|------|
| **W1** | Phase 1 Done | E0425 < 500 | â‰¥ 25% | âœ… or reassess |
| **W2** | Phase 2 Done | E0599 < 50 | â‰¥ 35% | âœ… or reassess |
| **W3** | Phase 3 Done | E0308 < 30 | â‰¥ 45% | âœ… or reassess |
| **W4** | Phase 4 Done | E0282 < 20 | â‰¥ 50% | **BREAKOUT** |

**Hard Falsification**: If we don't reach 40% by end of Week 3, escalate to architectural review.

---

### 2.5 Weekly Convergence Protocol

Every Friday:
```bash
# 1. Run convergence
cargo run --release --bin depyler -- converge --corpus examples/ --output weekly_report.json

# 2. Check metrics
jq '.compile_rate, .error_counts' weekly_report.json

# 3. Update spec with results
# Edit Section 1 "Current Status" with new numbers

# 4. If target missed: Document in GRAVEYARD.md and reassess
```

---

### 2.6 Ticket Summary

| Ticket | Description | Phase | Priority |
|--------|-------------|-------|----------|
| **GH-204** | E0425/E0423 Identifier Resolution | 1 | P0 |
| DEPYLER-1350 | E0599 Method Stub Generation | 2 | P1 |
| DEPYLER-1329 | CITL Pattern Store Wiring | 3 | P1 |
| DEPYLER-1327 | Corpus Tier Classification | New | P2 |
| DEPYLER-1324 | Differential Testing Framework | New | P2 |
| DEPYLER-1336 | Claude Sub-Agent Integration | New | P3 |
| DEPYLER-1355 | Type Annotation Inference | 4 | P3 |

---

## 3. Architecture Overview

Depyler uses a **Multi-Pass Compiler** architecture with an Oracle feedback loop:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Python    â”‚â”€â”€â”€â–¶â”‚  Transpiler â”‚â”€â”€â”€â–¶â”‚    Rust     â”‚
â”‚   Source    â”‚    â”‚  (depyler)  â”‚    â”‚   Source    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â–¼
                   â”‚   Oracle    â”‚â—€â”€â”€â”€â”€â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  (ML Model) â”‚     â”‚    rustc    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚   check     â”‚
                          â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Constraint â”‚
                   â”‚  Injection  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Components**:
- **Type Mapper**: Python â†’ Rust type inference
- **PyOps Traits**: `PyAdd`, `PySub`, `PyIndex`, `PyTruthy` for semantic parity
- **DepylerValue**: Universal fallback for dynamic types
- **Oracle**: ML model predicting error categories and fixes
- **CITL Flight Recorder**: Decision tracing for debugging
- **Escape Rate Tracker**: Monitors DepylerValue usage (DEPYLER-1321)

For detailed root cause analyses of past fixes, see [root-cause-analyses.md](./1.0-single-shot-compile-archive/root-cause-analyses.md).

---

## 4. Structural Typing Solutions

### 4.1 Automated Oracle Loop (Multi-Pass Architecture)

**Workflow**:
1. **Pass 1 (Heuristic)**: Transpile Python â†’ Rust using best-guess heuristics
2. **Oracle (Verification)**: Run `cargo check` to generate JSON diagnostics
3. **Learning (Constraint Extraction)**: Extract "expected T, found U" constraints
4. **Feedback (Refinement)**: Inject constraints into symbol table
5. **Pass 2 (Corrected)**: Re-transpile with guaranteed-correct type hints

### 4.2 PyOps Trait Dispatch

Instead of manual casting, we use Rust's trait system:
- **Traits**: `PyAdd<Rhs>`, `PyGetItem`, `PyTruthy`
- **Impls**: For `i32`, `f64`, `String`, `Vec<T>`, `DepylerValue`
- **Codegen**: Generate `x.py_add(y)` instead of `(x as f64) + y`

### 4.3 Sovereign Type DB

A compact binary artifact containing function signatures of popular Python libraries. See [Section 6](#6-sovereign-type-database) for details.

---

## 5. Performance Infrastructure

### RAM Disk Strategy

All build artifacts redirected to RAM disk for 60-80% speedup:

```bash
export TMPDIR=/Volumes/DepylerRAM/tmp
export CARGO_TARGET_DIR=/Volumes/DepylerRAM/cargo_target
```

**Recommended Size**: 64GB - 256GB

---

## 6. Sovereign Type Database

### Purpose
Eliminate type guesswork by providing ground truth for external library types.

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Harvesterâ”‚â”€â”€â”€â–¶â”‚ Extractor â”‚â”€â”€â”€â–¶â”‚ Parquet DB   â”‚
â”‚   (uv)   â”‚    â”‚(rustpythonâ”‚    â”‚ (arrow v54)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  parser)  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                                        â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ depyler-core â”‚
                                â”‚ type_mapper  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Usage

```bash
cargo run -p depyler-knowledge --bin build-type-db -- \
    --packages "requests,numpy,pandas" \
    --output crates/depyler-core/src/data/stdlib_types.parquet
```

---

## 7. Falsification Framework

### The Popperian Mandate

Per Karl Popper's falsificationism, each DEPYLER feature includes explicit falsification criteria.

### Strategic Falsifier

| ID | Criterion | Threshold |
|----|-----------|-----------|
| **S1** | E0308 Error Reduction after integration | **â‰¥10% reduction** |

If E0308 errors do not decrease by at least 10% after a major feature, the strategy is **FALSIFIED**.

### Validation Protocol

```bash
cargo test -p depyler-knowledge --test falsification
# Expected: NOT FALSIFIED (Implementation Valid)
```

For the complete 100-point falsifier checklist, see [falsifier-checklist.md](./1.0-single-shot-compile-archive/falsifier-checklist.md).

---

## 8. Epistemic Health Metrics (DEPYLER-1322)

### 8.1 The Popperian Critique

*"A theory that explains everything explains nothing."* â€” Karl Popper

Analysis reveals **paradigm exhaustion** at the 40% plateau:

| Phase | Strategy | Î” Compile Rate |
|-------|----------|----------------|
| 1-3 | Pattern matching | 0% â†’ 25% (+25 pp) |
| 4 | PyOps traits | 25% â†’ 33% (+8 pp) |
| 5 | Oracle loop | 33% â†’ 40% (+7 pp) |
| 6 | Dict Unification | Improvement varies by corpus |

**Diagnosis**: Protective belts (DepylerValue, Oracle Loop, NASA Mode) may be hiding failures rather than solving them.

### 8.2 DepylerValue Escape Rate (DEPYLER-1321 - COMPLETE)

**Definition**: Percentage of generated type annotations using `DepylerValue` as fallback.

```
Escape Rate = (DepylerValue annotations) / (Total type annotations) Ã— 100
```

**Implementation**: Added `EscapeRateTracker` with atomic counters for thread-safe tracking.

**Warning Thresholds**:
| Escape Rate | Status |
|-------------|--------|
| 0-10% | ğŸŸ¢ GREEN |
| 10-20% | ğŸŸ¡ YELLOW |
| >20% | ğŸ”´ RED (inference failing) |

### 8.3 Two-Tier Architecture Proposal

| Tier | Input | Output | Strategy |
|------|-------|--------|----------|
| **Tier 1** | Fully typed Python | Native Rust types | Direct mapping |
| **Tier 2** | Untyped Python | `DepylerValue` throughout | Universal embedding |

### 8.4 Differential Testing

**Protocol**:
```bash
# For each transpiled file:
1. Generate random inputs (1000 iterations)
2. Run Python: python script.py < inputs > python_output
3. Run Rust:   ./script < inputs > rust_output
4. Compare:    diff python_output rust_output
```

**Metric**: `Semantic Parity = (Files with matching output) / (Files that compile) Ã— 100`

### 8.5 Implementation Roadmap

| Phase | Task | Status | Ticket |
|-------|------|--------|--------|
| 8a | Escape Rate Tracking | âœ… COMPLETE | DEPYLER-1321 |
| 8b | Dashboard Integration | ğŸ“‹ Planned | DEPYLER-1323 |
| 8c | Differential Testing | ğŸ“‹ Planned | DEPYLER-1324 |
| 8d | Graveyard Creation | ğŸ“‹ Planned | DEPYLER-1325 |
| 8e | Untranspilable Grammar | ğŸ“‹ Planned | DEPYLER-1326 |
| 8f | Tier Classification | ğŸ“‹ Planned | DEPYLER-1327 |

---

## 9. ML Infrastructure Activation (DEPYLER-1328)

The `entrenar` and `aprender` crates contain substantial underutilized ML infrastructure.

### 9.1 Tier 1: Immediate Activation (Score â‰¥ 8.0)

| Feature | Score | Location | Ticket |
|---------|-------|----------|--------|
| **CITL Pattern Store** | 9.2 | `entrenar::citl_trainer` | DEPYLER-1329 |
| **Active Learning Gate** | 8.8 | `aprender::sampling` | DEPYLER-1330 |
| **Tarantula Fault Localization** | 8.5 | `entrenar::tarantula` | DEPYLER-1331 |
| **Isolation Forest** | 8.1 | `aprender::isolation_forest` | DEPYLER-1332 |

### 9.2 Tier 2: Near-Term (Score 6.0-8.0)

| Feature | Score | Ticket |
|---------|-------|--------|
| Online Learning | 7.6 | DEPYLER-1333 |
| ADWIN Drift Detection | 7.4 | DEPYLER-1334 |
| Mixture of Experts | 7.2 | DEPYLER-1335 |
| **Claude Sub-Agent** | 7.0 | DEPYLER-1336 |
| Feature Importance | 6.8 | DEPYLER-1337 |
| FailureContext Enrichment | 6.5 | DEPYLER-1338 |

### 9.3 Tier 3: Research (Score 4.0-6.0)

| Feature | Score | Ticket |
|---------|-------|--------|
| Knowledge Distillation | 5.8 | DEPYLER-1339 |
| Curriculum Learning | 5.5 | DEPYLER-1340 |
| GNN for AST | 5.2 | DEPYLER-1341 |
| Contrastive Learning | 4.8 | DEPYLER-1342 |

### 9.4 Implementation Roadmap

```
Q1 2026 (Immediate)
â”œâ”€â”€ DEPYLER-1329: CITL Pattern Store wiring
â”œâ”€â”€ DEPYLER-1330: Active Learning Gate
â”œâ”€â”€ DEPYLER-1331: Tarantula integration
â””â”€â”€ DEPYLER-1332: Isolation Forest anomaly detection

Q2 2026 (Near-Term)
â”œâ”€â”€ DEPYLER-1333-1338: Tier 2 features
â””â”€â”€ DEPYLER-1336: Claude Sub-Agent MVP

Q3 2026 (Research)
â””â”€â”€ DEPYLER-1339-1342: Tier 3 experiments
```

---

## Appendix D: Phase 6 Empirical Findings

### Phase 6c: The Unification Treaty (DEPYLER-1320)

**Problem**: Civil war between two codegen paths for dict access.

**Root Causes Fixed**:
1. `direct_rules_convert.rs::convert_index` - Added `.into()` for NASA mode
2. `stmt_gen.rs` - Skip redundant JSON-to-String conversion
3. `type_tokens.rs` - Updated Unknown type mapping

**Empirical Result**: +10.3pp improvement on test corpus (29.0% â†’ 39.3%)

### Phase 6d: Current Status (DEPYLER-1321)

**Dashboard Output** (Oracle v3.22.0):
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           PHASE 6d DASHBOARD                                 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Passing:           13/80 (16.25%) - examples corpus          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ TOP CLUSTER: E0425 (1,487 errors)                            â•‘
â•‘ ROOT CAUSE:  Missing Import / Unresolved Identifiers         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ NEW METRIC:  Escape Rate Tracking ACTIVE                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Appendix E: Claude Sub-Agent Architecture

### System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Oracle Pipeline                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Error      â”‚â”€â”€â”€â–¶â”‚   Oracle     â”‚â”€â”€â”€â–¶â”‚   Confidence     â”‚  â”‚
â”‚  â”‚   Input      â”‚    â”‚   Predict    â”‚    â”‚   Check          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                    â”‚             â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                           â–¼                                â–¼    â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                  â”‚ Confidence â‰¥ T â”‚              â”‚Confidence <Tâ”‚â”‚
â”‚                  â”‚ (Use Oracle)   â”‚              â”‚(Escalate)   â”‚â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                         â”‚       â”‚
â”‚                                                         â–¼       â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                              â”‚  Claude API      â”‚â”‚
â”‚                                              â”‚  Sub-Agent       â”‚â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Query Protocol

```rust
pub struct ClaudeQuery {
    pub error: CompilerError,
    pub python_source: String,
    pub rust_source: String,
    pub oracle_prediction: Option<ErrorCategory>,
    pub oracle_confidence: f64,
}

pub struct ClaudeResponse {
    pub category: ErrorCategory,
    pub explanation: String,
    pub fix_suggestion: Option<String>,
    pub confidence: f64,
    pub reasoning: Vec<String>,
}
```

### Cost-Benefit Analysis

| Factor | Value |
|--------|-------|
| API Cost | ~$0.015 per escalation (Claude Haiku) |
| Expected Escalation Rate | 5-10% of predictions |
| Fix Accuracy Improvement | Est. +20% on escalated cases |
| Latency | +500-2000ms per escalation |

### Safeguards

1. **Rate Limiting**: Max 100 queries/hour
2. **Caching**: Hash(error + source) â†’ response cache (24h TTL)
3. **Fallback**: If API unavailable, return Oracle prediction
4. **Audit Log**: All queries logged for training data
5. **Cost Cap**: Monthly budget limit with automatic disable

---

## Appendix F: Falsification Record

This appendix documents claims that have been falsified through empirical testing, per the Popperian methodology.

### F.1 Falsified Claim: 100% TRUE Success Rate (Jan 26, 2026)

**Original Claim** (v3.0.0):
> "The Depyler transpiler now achieves 100.0% semantic parity (178/178 files) on the entire frozen corpus."

**Falsification Evidence**:
- Independent audit against real corpus (not curated test files)
- 62/178 files succeed (34.83%)
- 116/178 files fail (65.17%)

**Root Cause**:
The 178 `semantic_test_*.py` files were created specifically to work within known transpiler limitations. They achieved 100% because they avoided:
- Classes and OOP
- Async/await
- Decorators
- Context managers (`with` statements)
- Complex standard library modules

**Corrective Action**:
- Retracted 100% claim
- Updated spec to v3.1.0 with honest assessment
- Real corpus success rate documented: 34.83%
- Added blocking tickets for unsupported features

**Lesson Learned**:
"100% success often indicates that the domain of testing is too small, not that the theory is perfect." â€” Epistemic Advisor

### F.2 Historical Claims (For Reference)

| Version | Claim | Corpus | Actual (Real) | Status |
|---------|-------|--------|---------------|--------|
| v3.0.0 | 100% | Curated | 34.83% | âŒ FALSIFIED |
| v2.15.0 | 80.3% | Curated | ~34% | âŒ Overstated |
| v2.14.0 | 75.8% | Curated | ~34% | âŒ Overstated |

All historical claims were measured against the curated `semantic_test_*` corpus, not the real corpus.

### F.3 Validated Capabilities

The following capabilities ARE validated on the curated corpus:

| Capability | Evidence | Limitation |
|------------|----------|------------|
| Pure functions (typed) | 100% on semantic_test_* | No classes, no async |
| String operations | 100% on semantic_test_* | Basic methods only |
| List operations | 100% on semantic_test_* | No comprehensions |
| Dict operations | 100% on semantic_test_* | Simple cases only |
| Control flow | 100% on semantic_test_* | No exceptions |
| Boolean logic | 100% on semantic_test_* | Standard operators |

These results are valid but represent a **constrained domain**, not general Python.

---

## Appendix G: Oracle User Training (DEPYLER-ORACLE-TRAIN)

### G.1 Overview

The Oracle now supports **user corpus training** â€” a kaizen-style feedback loop that learns project-specific errorâ†’fix patterns for faster future convergence.

**Status**: âœ… IMPLEMENTED (v3.5.0)

### G.2 Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Corpus    â”‚
â”‚  (*.py files)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Converge Loop  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  py â†’ rs â†’ rustcâ”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
         â”‚                        â”‚
         â–¼ (error)                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  Apply Fix      â”‚               â”‚
â”‚  E0308 â†’ as_str â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
         â”‚                        â”‚
         â–¼                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ Record Feedback â”‚               â”‚
â”‚ learn_pattern() â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
         â”‚                        â”‚
         â–¼                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ NgramPredictor  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ HashMap<Cat,Fix>â”‚    (next iteration)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Save Model     â”‚
â”‚ ~/.depyler/*.binâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### G.3 Key Components

| Component | File | Purpose |
|-----------|------|---------|
| `NgramFixPredictor` | `crates/depyler-oracle/src/ngram.rs` | TF-IDF pattern matching |
| `save()` / `load()` | `ngram.rs:321-365` | Model persistence |
| `ErrorCategory::from_code()` | `classifier.rs` | E0308â†’TypeMismatch mapping |
| Feedback wiring | `crates/depyler/src/converge/mod.rs` | Records patterns on fix |
| Train command | `crates/depyler/src/lib.rs` | CLI interface |

### G.4 Usage

```bash
# Train Oracle on user corpus
depyler train --corpus ./my_python_project

# Custom output path
depyler train --corpus ./src --output ./models/custom.bin

# Run the example
cargo run --example oracle_user_training -p depyler-oracle
```

### G.5 Data Flow

1. **Init**: Load existing user model from `~/.depyler/oracle_user.bin`
2. **Converge**: For each Python file, attempt transpile â†’ compile
3. **Fix Applied**: When autofix resolves an error, call `learn_pattern()`
4. **Record**: Maps `error_message` â†’ `fix_template` by `ErrorCategory`
5. **Save**: Persist updated patterns to user model file
6. **Future Runs**: Load and apply learned patterns immediately

### G.6 Benefits

- **Project-specific learning**: Patterns tuned to your codebase idioms
- **Incremental improvement**: Each run enriches the oracle
- **Faster convergence**: Known patterns applied without re-discovery
- **Local knowledge**: No one-size-fits-all assumptions

### G.7 Files Added

| File | Purpose |
|------|---------|
| `docs/oracle-training.md` | User guide with architecture diagram |
| `docs/images/oracle-training.svg` | 1920x1080 visual architecture |
| `crates/depyler-oracle/examples/oracle_user_training.rs` | Runnable demo |

### G.8 Falsification Criteria

| Criterion | Threshold | Measurement |
|-----------|-----------|-------------|
| Pattern persistence | Must survive restart | `load()` returns >0 patterns after `save()` |
| Convergence speedup | â‰¥10% fewer iterations on trained corpus | Compare iterations before/after training |
| Model file created | `~/.depyler/oracle_user.bin` exists | File system check |

---

**End of Specification**
