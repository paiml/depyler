# 12.7 Playground Architecture: Simular + Probar (DEPYLER-PLAYGROUND-002)

[← Back to TOC](../pareto-complete-single-shot.md)

---

## Problem Statement

| Issue | Impact |
|-------|--------|
| Complex TypeScript/React stack | 70+ npm deps, slow builds |
| Untestable with probar | No GUI coverage, no determinism |
| JavaScript dependency | Security surface, non-deterministic |
| Separate codebase | Drift from transpiler core |

---

## Solution: Delete and Replace

```
BEFORE:                              AFTER:
playground/                          crates/depyler-playground/
├── node_modules/ (500MB+)           ├── Cargo.toml
├── src/ (React/TS)                  ├── src/
└── package.json                     │   ├── lib.rs (WASM)
                                     │   ├── app.rs (simular)
                                     │   └── ui.rs (TUI)
                                     └── tests/probar/
```

---

## Architecture

```
┌─────────────────────────────────────────────────────────┐
│              DEPYLER PLAYGROUND (simular)               │
├─────────────────────────────────────────────────────────┤
│  simular::App          │     depyler-core (direct)     │
│  ┌───────────────┐     │  ┌─────────────────────────┐  │
│  │ Python Editor │─────┼─▶│ transpile() -> Rust     │  │
│  │ Rust Output   │◀────┼──│ score() -> 0-100        │  │
│  │ Score Display │     │  └─────────────────────────┘  │
│  └───────────────┘     │                               │
├─────────────────────────────────────────────────────────┤
│  Targets: WASM (37KB) │ TUI (ratatui) │ Headless       │
└─────────────────────────────────────────────────────────┘
```

---

## Probar Testing Requirements

| Requirement | Threshold | Probar Feature |
|-------------|-----------|----------------|
| GUI Coverage | ≥95% | `gui_coverage!` |
| Deterministic Replay | Bit-identical | `--seed 42` |
| Visual Regression | 0 pixel drift | `expect_screenshot()` |
| Headless Testing | <1s/test | `WasmDriver::headless()` |

---

## Implementation

```rust
use simular::prelude::*;
use depyler_core::{transpile_to_rust, SingleShotScore};

pub struct DepylerPlayground {
    python_source: String,
    rust_output: String,
    score: SingleShotScore,
}

impl simular::App for DepylerPlayground {
    fn update(&mut self, ctx: &mut Context) {
        if ctx.input_changed("python_editor") {
            self.python_source = ctx.get_text("python_editor");
            let (rust, score) = transpile_to_rust(&self.python_source)?;
            self.rust_output = rust;
            self.score = score;
        }
    }

    fn view(&self, ui: &mut UI) {
        ui.editor("python_editor", &self.python_source);
        ui.code_view("rust_output", &self.rust_output);
        ui.score_display("score", self.score.total);
    }
}
```

---

## Migration Plan

| Phase | Action |
|-------|--------|
| P1 | Create `crates/depyler-playground` |
| P2 | Implement transpilation bindings |
| P3 | Build simular UI |
| P4 | Write probar tests (95% GUI coverage) |
| P5 | **DELETE `playground/` directory** |
| P6 | Update CI/CD |

---

## Benefits

| Metric | Current | Proposed |
|--------|---------|----------|
| Build size | 2.5MB+ JS | 37KB WASM |
| Dependencies | 70+ npm | 3 Rust crates |
| Test framework | Jest | probar |
| Determinism | No | Yes |
| CI time | 3+ min | <30s |

---

## Acceptance Criteria

- [ ] **AC-PG1**: `playground/` deleted
- [ ] **AC-PG2**: WASM <50KB
- [ ] **AC-PG3**: probar GUI coverage ≥95%
- [ ] **AC-PG4**: Tests pass with `--seed 42`
- [ ] **AC-PG5**: TUI mode works
- [ ] **AC-PG6**: Zero JavaScript
