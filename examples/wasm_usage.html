<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Depyler WASM Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        textarea {
            width: 100%;
            height: 300px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .metric {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .options {
            margin: 20px 0;
        }
        .option {
            margin: 10px 0;
        }
        .option label {
            display: inline-block;
            width: 150px;
        }
        #analysis-results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Depyler WASM Demo</h1>
    <p>Python to Rust transpiler running entirely in your browser</p>

    <div class="options">
        <h3>Transpilation Options</h3>
        <div class="option">
            <label>
                <input type="checkbox" id="verify" checked> Enable Verification
            </label>
        </div>
        <div class="option">
            <label>
                <input type="checkbox" id="optimize" checked> Enable Optimization
            </label>
        </div>
        <div class="option">
            <label>
                <input type="checkbox" id="emit-docs"> Emit Documentation
            </label>
        </div>
        <div class="option">
            <label>Target Version:</label>
            <input type="text" id="target-version" value="1.83" style="width: 60px;">
        </div>
    </div>

    <div class="container">
        <div class="panel">
            <h2>Python Input</h2>
            <textarea id="python-input" placeholder="Enter your Python code here...">
def fibonacci(n: int) -> int:
    """Calculate the nth Fibonacci number."""
    if n <= 1:
        return n
    return fibonacci(n - 1) + fibonacci(n - 2)

def factorial(n: int) -> int:
    """Calculate factorial of n."""
    if n <= 1:
        return 1
    return n * factorial(n - 1)

def binary_search(arr: list, target: int) -> int:
    """Binary search implementation."""
    left, right = 0, len(arr) - 1
    
    while left <= right:
        mid = (left + right) // 2
        if arr[mid] == target:
            return mid
        elif arr[mid] < target:
            left = mid + 1
        else:
            right = mid - 1
    
    return -1
</textarea>
        </div>
        
        <div class="panel">
            <h2>Rust Output</h2>
            <textarea id="rust-output" readonly placeholder="Transpiled Rust code will appear here..."></textarea>
        </div>
    </div>

    <div>
        <button onclick="transpile()">Transpile</button>
        <button onclick="analyze()">Analyze Code</button>
        <button onclick="benchmark()">Run Benchmark</button>
        <button onclick="clearAll()">Clear</button>
    </div>

    <div id="status"></div>

    <div class="metrics" id="metrics" style="display: none;">
        <div class="metric">
            <div class="metric-value" id="transpile-time">0</div>
            <div class="metric-label">Transpile Time (ms)</div>
        </div>
        <div class="metric">
            <div class="metric-value" id="energy-joules">0</div>
            <div class="metric-label">Energy (mJ)</div>
        </div>
        <div class="metric">
            <div class="metric-value" id="pmat-score">0</div>
            <div class="metric-label">PMAT Score</div>
        </div>
        <div class="metric">
            <div class="metric-value" id="complexity">0</div>
            <div class="metric-label">Complexity</div>
        </div>
        <div class="metric">
            <div class="metric-value" id="confidence">0</div>
            <div class="metric-label">Confidence (%)</div>
        </div>
    </div>

    <div id="analysis-results" style="display: none;">
        <h3>Code Analysis Results</h3>
        <div id="analysis-content"></div>
    </div>

    <script type="module">
        import init, { DepylerWasm, WasmTranspileOptions } from './pkg/depyler_wasm.js';

        let depyler = null;

        // Initialize WASM module
        async function initWasm() {
            await init();
            depyler = new DepylerWasm();
            document.getElementById('status').innerHTML = 
                '<div class="success">Depyler WASM loaded successfully!</div>';
        }

        // Transpile function
        window.transpile = async function() {
            if (!depyler) {
                alert('Please wait for WASM to load');
                return;
            }

            const pythonCode = document.getElementById('python-input').value;
            const options = new WasmTranspileOptions();
            
            // Set options from UI
            options.set_verify(document.getElementById('verify').checked);
            options.set_optimize(document.getElementById('optimize').checked);
            options.set_emit_docs(document.getElementById('emit-docs').checked);
            options.set_target_version(document.getElementById('target-version').value);

            try {
                const result = depyler.transpile(pythonCode, options);
                
                if (result.success()) {
                    // Display Rust code
                    document.getElementById('rust-output').value = result.rust_code();
                    
                    // Show metrics
                    document.getElementById('metrics').style.display = 'grid';
                    document.getElementById('transpile-time').textContent = 
                        result.transpile_time_ms().toFixed(2);
                    document.getElementById('energy-joules').textContent = 
                        (result.energy_estimate().joules() * 1000).toFixed(3);
                    document.getElementById('pmat-score').textContent = 
                        result.quality_metrics().pmat_score().toFixed(2);
                    document.getElementById('complexity').textContent = 
                        result.quality_metrics().code_complexity();
                    document.getElementById('confidence').textContent = 
                        (result.energy_estimate().confidence() * 100).toFixed(0);
                    
                    document.getElementById('status').innerHTML = 
                        '<div class="success">Transpilation successful!</div>';
                } else {
                    document.getElementById('rust-output').value = '';
                    document.getElementById('status').innerHTML = 
                        `<div class="error">Errors: ${result.errors().join(', ')}</div>`;
                }
            } catch (e) {
                document.getElementById('status').innerHTML = 
                    `<div class="error">Error: ${e.message}</div>`;
            }
        };

        // Analyze function
        window.analyze = async function() {
            if (!depyler) {
                alert('Please wait for WASM to load');
                return;
            }

            const pythonCode = document.getElementById('python-input').value;
            
            try {
                const analysis = depyler.analyze_code(pythonCode);
                
                document.getElementById('analysis-results').style.display = 'block';
                document.getElementById('analysis-content').textContent = 
                    JSON.stringify(analysis, null, 2);
                
                document.getElementById('status').innerHTML = 
                    '<div class="success">Analysis complete!</div>';
            } catch (e) {
                document.getElementById('status').innerHTML = 
                    `<div class="error">Analysis error: ${e.message}</div>`;
            }
        };

        // Benchmark function
        window.benchmark = async function() {
            if (!depyler) {
                alert('Please wait for WASM to load');
                return;
            }

            const pythonCode = document.getElementById('python-input').value;
            
            document.getElementById('status').innerHTML = 
                '<div class="success">Running benchmark (10 iterations)...</div>';
            
            try {
                const results = depyler.benchmark(pythonCode, 10);
                
                const output = `Benchmark Results:
- Iterations: ${results.iterations}
- Min: ${results.min_ms.toFixed(2)}ms
- Max: ${results.max_ms.toFixed(2)}ms
- Mean: ${results.mean_ms.toFixed(2)}ms
- Median: ${results.median_ms.toFixed(2)}ms
- Std Dev: ${results.std_dev_ms.toFixed(2)}ms`;
                
                document.getElementById('analysis-results').style.display = 'block';
                document.getElementById('analysis-content').textContent = output;
                
                document.getElementById('status').innerHTML = 
                    '<div class="success">Benchmark complete!</div>';
            } catch (e) {
                document.getElementById('status').innerHTML = 
                    `<div class="error">Benchmark error: ${e.message}</div>`;
            }
        };

        // Clear function
        window.clearAll = function() {
            document.getElementById('python-input').value = '';
            document.getElementById('rust-output').value = '';
            document.getElementById('metrics').style.display = 'none';
            document.getElementById('analysis-results').style.display = 'none';
            document.getElementById('status').innerHTML = '';
        };

        // Load example snippets
        const examples = {
            fibonacci: `def fibonacci(n: int) -> int:
    """Calculate the nth Fibonacci number."""
    if n <= 1:
        return n
    return fibonacci(n - 1) + fibonacci(n - 2)`,
            
            sorting: `def bubble_sort(arr: list) -> list:
    """Sort array using bubble sort algorithm."""
    n = len(arr)
    for i in range(n):
        for j in range(0, n - i - 1):
            if arr[j] > arr[j + 1]:
                arr[j], arr[j + 1] = arr[j + 1], arr[j]
    return arr`,
            
            datastructure: `class Stack:
    """A simple stack implementation."""
    def __init__(self):
        self.items = []
    
    def push(self, item: int) -> None:
        self.items.append(item)
    
    def pop(self) -> int:
        if self.items:
            return self.items.pop()
        return -1
    
    def is_empty(self) -> bool:
        return len(self.items) == 0`
        };

        // Initialize on load
        initWasm();
    </script>
</body>
</html>