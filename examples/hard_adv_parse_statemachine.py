# Generated by: depyler corpus generator
# Source: hard_adv_parse_statemachine.py
#
# State machine parser for recognizing patterns in integer sequences.
# States: 0=START, 1=READING_A, 2=READING_B, 3=ACCEPT, 4=REJECT


def transition(state: int, input_val: int) -> int:
    """Transition function for pattern a+b+ (sequences of 1s then 2s)."""
    if state == 0:
        if input_val == 1:
            return 1
        return 4
    elif state == 1:
        if input_val == 1:
            return 1
        if input_val == 2:
            return 2
        return 4
    elif state == 2:
        if input_val == 2:
            return 2
        return 4
    elif state == 3:
        return 3
    return 4


def run_machine(inputs: list[int]) -> int:
    """Run state machine on input. Returns 1 if accepts, 0 if rejects."""
    state: int = 0
    i: int = 0
    n: int = len(inputs)
    while i < n:
        val: int = inputs[i]
        state = transition(state, val)
        if state == 4:
            return 0
        i = i + 1
    if state == 2:
        return 1
    return 0


def count_transitions(inputs: list[int]) -> int:
    """Count the number of state transitions (state changes)."""
    cnt: int = 0
    state: int = 0
    i: int = 0
    n: int = len(inputs)
    while i < n:
        val: int = inputs[i]
        new_state: int = transition(state, val)
        if new_state != state:
            cnt = cnt + 1
        state = new_state
        i = i + 1
    return cnt


def build_trace(inputs: list[int]) -> list[int]:
    """Build a trace of all states visited."""
    trace: list[int] = [0]
    state: int = 0
    i: int = 0
    n: int = len(inputs)
    while i < n:
        val: int = inputs[i]
        state = transition(state, val)
        trace.append(state)
        i = i + 1
    return trace


def find_first_reject(inputs: list[int]) -> int:
    """Find position of first input that causes rejection, or -1."""
    state: int = 0
    i: int = 0
    n: int = len(inputs)
    while i < n:
        val: int = inputs[i]
        state = transition(state, val)
        if state == 4:
            return i
        i = i + 1
    return -1


def test_module() -> int:
    """Test state machine parser."""
    passed: int = 0

    r1: int = run_machine([1, 1, 2, 2])
    if r1 == 1:
        passed = passed + 1

    r2: int = run_machine([1, 2, 1])
    if r2 == 0:
        passed = passed + 1

    r3: int = run_machine([2, 2])
    if r3 == 0:
        passed = passed + 1

    ct: int = count_transitions([1, 1, 2, 2])
    if ct == 2:
        passed = passed + 1

    trace: list[int] = build_trace([1, 2])
    if len(trace) == 3:
        passed = passed + 1

    fr: int = find_first_reject([1, 3, 2])
    if fr == 1:
        passed = passed + 1

    return passed
