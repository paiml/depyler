# Generated by: depyler corpus generator
# Source: hard_cp_graph_flow.py
#
# Network flow (Edmonds-Karp) for transpiler stress testing.


def bfs_augment(capacity: list[list[int]], source: int, sink: int, parent: list[int]) -> int:
    """BFS to find augmenting path. Returns 1 if path exists, 0 otherwise."""
    n: int = len(capacity)
    visited: list[int] = [0] * n
    queue: list[int] = [source]
    visited[source] = 1
    parent[source] = 0 - 1
    qi: int = 0
    while qi < len(queue):
        u: int = queue[qi]
        v: int = 0
        while v < n:
            if visited[v] == 0 and capacity[u][v] > 0:
                visited[v] = 1
                parent[v] = u
                if v == sink:
                    return 1
                queue.append(v)
            v = v + 1
        qi = qi + 1
    return 0


def max_flow_edmonds_karp(capacity: list[list[int]], source: int, sink: int) -> int:
    """Edmonds-Karp max flow algorithm (BFS-based Ford-Fulkerson)."""
    n: int = len(capacity)
    residual: list[list[int]] = []
    i: int = 0
    while i < n:
        row: list[int] = [0] * n
        j: int = 0
        while j < n:
            row[j] = capacity[i][j]
            j = j + 1
        residual.append(row)
        i = i + 1
    parent: list[int] = [0 - 1] * n
    total_flow: int = 0
    found: int = bfs_augment(residual, source, sink, parent)
    while found == 1:
        path_flow: int = 999999999
        v: int = sink
        while v != source:
            u: int = parent[v]
            cap_val: int = residual[u][v]
            if cap_val < path_flow:
                path_flow = cap_val
            v = u
        v2: int = sink
        while v2 != source:
            u2: int = parent[v2]
            residual[u2][v2] = residual[u2][v2] - path_flow
            residual[v2][u2] = residual[v2][u2] + path_flow
            v2 = u2
        total_flow = total_flow + path_flow
        parent = [0 - 1] * n
        found = bfs_augment(residual, source, sink, parent)
    return total_flow


def min_cut_value(capacity: list[list[int]], source: int, sink: int) -> int:
    """Min cut value equals max flow by max-flow min-cut theorem."""
    return max_flow_edmonds_karp(capacity, source, sink)


def test_module() -> int:
    passed: int = 0
    cap1: list[list[int]] = [
        [0, 16, 13, 0, 0, 0],
        [0, 0, 10, 12, 0, 0],
        [0, 4, 0, 0, 14, 0],
        [0, 0, 9, 0, 0, 20],
        [0, 0, 0, 7, 0, 4],
        [0, 0, 0, 0, 0, 0],
    ]
    if max_flow_edmonds_karp(cap1, 0, 5) == 23:
        passed = passed + 1
    cap2: list[list[int]] = [
        [0, 10, 10, 0],
        [0, 0, 0, 10],
        [0, 0, 0, 10],
        [0, 0, 0, 0],
    ]
    if max_flow_edmonds_karp(cap2, 0, 3) == 20:
        passed = passed + 1
    if min_cut_value(cap2, 0, 3) == 20:
        passed = passed + 1
    cap3: list[list[int]] = [
        [0, 5, 0],
        [0, 0, 5],
        [0, 0, 0],
    ]
    if max_flow_edmonds_karp(cap3, 0, 2) == 5:
        passed = passed + 1
    cap4: list[list[int]] = [
        [0, 0],
        [0, 0],
    ]
    if max_flow_edmonds_karp(cap4, 0, 1) == 0:
        passed = passed + 1
    return passed
