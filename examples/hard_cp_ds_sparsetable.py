# Generated by: depyler corpus generator
# Source: hard_cp_ds_sparsetable.py
#
# Sparse table for range minimum queries for transpiler stress testing.


def log2_floor(n: int) -> int:
    """Floor of log base 2."""
    if n <= 0:
        return 0
    result: int = 0
    x: int = n
    while x > 1:
        x = x // 2
        result = result + 1
    return result


def sparse_table_build(arr: list[int]) -> list[list[int]]:
    """Build sparse table for range minimum query."""
    n: int = len(arr)
    if n == 0:
        return []
    k: int = log2_floor(n) + 1
    table: list[list[int]] = []
    j: int = 0
    while j < k:
        row: list[int] = [0] * n
        table.append(row)
        j = j + 1
    i: int = 0
    while i < n:
        table[0][i] = arr[i]
        i = i + 1
    p: int = 1
    while p < k:
        i2: int = 0
        half: int = 1 << (p - 1)
        while i2 + (1 << p) - 1 < n:
            left: int = table[p - 1][i2]
            right: int = table[p - 1][i2 + half]
            if left < right:
                table[p][i2] = left
            else:
                table[p][i2] = right
            i2 = i2 + 1
        p = p + 1
    return table


def sparse_table_query(table: list[list[int]], left: int, right: int) -> int:
    """Range minimum query using sparse table. O(1) per query."""
    length: int = right - left + 1
    k: int = log2_floor(length)
    half: int = 1 << k
    a: int = table[k][left]
    b: int = table[k][right - half + 1]
    if a < b:
        return a
    return b


def range_min_brute(arr: list[int], left: int, right: int) -> int:
    """Brute force range minimum for validation."""
    best: int = arr[left]
    i: int = left + 1
    while i <= right:
        if arr[i] < best:
            best = arr[i]
        i = i + 1
    return best


def test_module() -> int:
    passed: int = 0
    arr: list[int] = [7, 2, 3, 0, 5, 10, 3, 12, 18]
    table: list[list[int]] = sparse_table_build(arr)
    if sparse_table_query(table, 0, 8) == 0:
        passed = passed + 1
    if sparse_table_query(table, 4, 7) == 3:
        passed = passed + 1
    if sparse_table_query(table, 0, 1) == 2:
        passed = passed + 1
    if log2_floor(8) == 3:
        passed = passed + 1
    if range_min_brute(arr, 2, 5) == 0:
        passed = passed + 1
    return passed
