# Generated by: depyler corpus generator
# Source: hard_cp_ds_fenwick.py
#
# Fenwick tree (Binary Indexed Tree) for transpiler stress testing.


def fenwick_build(arr: list[int]) -> list[int]:
    """Build a Fenwick tree from array."""
    n: int = len(arr)
    tree: list[int] = [0] * (n + 1)
    i: int = 0
    while i < n:
        idx: int = i + 1
        while idx <= n:
            tree[idx] = tree[idx] + arr[i]
            idx = idx + (idx & (0 - idx))
        i = i + 1
    return tree


def fenwick_update(tree: list[int], idx: int, delta: int) -> list[int]:
    """Point update: add delta to position idx (0-indexed)."""
    n: int = len(tree) - 1
    pos: int = idx + 1
    while pos <= n:
        tree[pos] = tree[pos] + delta
        pos = pos + (pos & (0 - pos))
    return tree


def fenwick_prefix_sum(tree: list[int], idx: int) -> int:
    """Prefix sum query: sum of elements 0..idx (0-indexed)."""
    total: int = 0
    pos: int = idx + 1
    while pos > 0:
        total = total + tree[pos]
        pos = pos - (pos & (0 - pos))
    return total


def fenwick_range_sum(tree: list[int], left: int, right: int) -> int:
    """Range sum query: sum of elements left..right (0-indexed, inclusive)."""
    if left == 0:
        return fenwick_prefix_sum(tree, right)
    return fenwick_prefix_sum(tree, right) - fenwick_prefix_sum(tree, left - 1)


def count_inversions_fenwick(arr: list[int], max_val: int) -> int:
    """Count inversions using Fenwick tree."""
    n: int = len(arr)
    tree: list[int] = [0] * (max_val + 2)
    inversions: int = 0
    i: int = n - 1
    while i >= 0:
        val: int = arr[i]
        if val > 0:
            total: int = 0
            pos: int = val - 1 + 1
            while pos > 0:
                total = total + tree[pos]
                pos = pos - (pos & (0 - pos))
            inversions = inversions + total
        update_pos: int = val + 1
        while update_pos <= max_val + 1:
            tree[update_pos] = tree[update_pos] + 1
            update_pos = update_pos + (update_pos & (0 - update_pos))
        i = i - 1
    return inversions


def test_module() -> int:
    passed: int = 0
    arr: list[int] = [1, 3, 5, 7, 9]
    tree: list[int] = fenwick_build(arr)
    if fenwick_prefix_sum(tree, 4) == 25:
        passed = passed + 1
    if fenwick_prefix_sum(tree, 2) == 9:
        passed = passed + 1
    if fenwick_range_sum(tree, 1, 3) == 15:
        passed = passed + 1
    fenwick_update(tree, 2, 5)
    if fenwick_prefix_sum(tree, 4) == 30:
        passed = passed + 1
    if count_inversions_fenwick([3, 1, 2], 3) == 2:
        passed = passed + 1
    return passed
