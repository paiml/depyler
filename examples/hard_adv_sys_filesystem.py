# Generated by: depyler corpus generator
# Source: hard_adv_sys_filesystem.py
#
# Simple file system simulation: inode table, block allocation, directory entries.


def init_inode_table(capacity: int) -> list[int]:
    """Initialize inode table. -1 = free, otherwise = file size."""
    tbl: list[int] = []
    i: int = 0
    while i < capacity:
        tbl.append(-1)
        i = i + 1
    return tbl


def create_file(inodes: list[int], file_size: int) -> int:
    """Create a file by finding a free inode. Returns inode index or -1."""
    i: int = 0
    n: int = len(inodes)
    while i < n:
        iv: int = inodes[i]
        if iv == -1:
            inodes[i] = file_size
            return i
        i = i + 1
    return -1


def delete_file(inodes: list[int], inode_idx: int) -> int:
    """Delete a file by freeing its inode. Returns freed size or -1."""
    n: int = len(inodes)
    if inode_idx < 0 or inode_idx >= n:
        return -1
    old_size: int = inodes[inode_idx]
    if old_size == -1:
        return -1
    inodes[inode_idx] = -1
    return old_size


def count_files(inodes: list[int]) -> int:
    """Count active files in inode table."""
    cnt: int = 0
    i: int = 0
    n: int = len(inodes)
    while i < n:
        iv: int = inodes[i]
        if iv >= 0:
            cnt = cnt + 1
        i = i + 1
    return cnt


def total_used_space(inodes: list[int]) -> int:
    """Sum of all file sizes."""
    total: int = 0
    i: int = 0
    n: int = len(inodes)
    while i < n:
        iv: int = inodes[i]
        if iv > 0:
            total = total + iv
        i = i + 1
    return total


def blocks_needed(file_size: int, block_size: int) -> int:
    """Compute blocks needed for a file."""
    if file_size <= 0:
        return 0
    return (file_size + block_size - 1) // block_size


def allocate_blocks(free_bitmap: list[int], count: int) -> list[int]:
    """Allocate count blocks from free bitmap. Returns allocated block indices."""
    allocated: list[int] = []
    i: int = 0
    n: int = len(free_bitmap)
    while i < n and len(allocated) < count:
        bv: int = free_bitmap[i]
        if bv == 0:
            free_bitmap[i] = 1
            allocated.append(i)
        i = i + 1
    return allocated


def test_module() -> int:
    """Test file system functions."""
    passed: int = 0

    inodes: list[int] = init_inode_table(8)
    if len(inodes) == 8:
        passed = passed + 1

    idx: int = create_file(inodes, 1024)
    if idx == 0:
        passed = passed + 1

    idx2: int = create_file(inodes, 512)
    if idx2 == 1:
        passed = passed + 1

    cnt: int = count_files(inodes)
    if cnt == 2:
        passed = passed + 1

    freed: int = delete_file(inodes, 0)
    if freed == 1024:
        passed = passed + 1

    bn: int = blocks_needed(1500, 512)
    if bn == 3:
        passed = passed + 1

    bitmap: list[int] = [0, 1, 0, 0, 1]
    alloc: list[int] = allocate_blocks(bitmap, 2)
    if len(alloc) == 2:
        passed = passed + 1

    return passed
