# Generated by: depyler corpus generator
# Source: hard_adv_net_circuit.py
#
# Circuit breaker pattern: track failures and open/close circuit.
# States: 0=CLOSED, 1=OPEN, 2=HALF_OPEN


def circuit_state_name(state: int) -> int:
    """Return state identifier (0=CLOSED, 1=OPEN, 2=HALF_OPEN)."""
    if state == 0:
        return 0
    if state == 1:
        return 1
    if state == 2:
        return 2
    return -1


def record_success(fail_count: int) -> int:
    """On success, reset failure count to 0."""
    return 0


def record_failure(fail_count: int) -> int:
    """On failure, increment failure count."""
    return fail_count + 1


def evaluate_state(fail_count: int, threshold: int, cooldown_remaining: int) -> int:
    """Determine circuit state based on failure count and cooldown."""
    if cooldown_remaining > 0:
        return 1
    if fail_count >= threshold:
        return 1
    return 0


def simulate_circuit(events: list[int], threshold: int, cooldown: int) -> list[int]:
    """Simulate circuit breaker. events: 1=success, 0=failure.
    Returns list of states after each event."""
    states: list[int] = []
    fail_count: int = 0
    cooldown_rem: int = 0
    i: int = 0
    n: int = len(events)
    while i < n:
        evt: int = events[i]
        if cooldown_rem > 0:
            cooldown_rem = cooldown_rem - 1
            if cooldown_rem == 0:
                state: int = 2
                states.append(state)
                if evt == 1:
                    fail_count = record_success(fail_count)
                else:
                    fail_count = record_failure(fail_count)
                    cooldown_rem = cooldown
                i = i + 1
                continue
            else:
                states.append(1)
                i = i + 1
                continue
        if evt == 1:
            fail_count = record_success(fail_count)
        else:
            fail_count = record_failure(fail_count)
        cur_state: int = evaluate_state(fail_count, threshold, cooldown_rem)
        if cur_state == 1 and cooldown_rem == 0:
            cooldown_rem = cooldown
        states.append(cur_state)
        i = i + 1
    return states


def count_open_states(states: list[int]) -> int:
    """Count how many times the circuit was OPEN."""
    cnt: int = 0
    i: int = 0
    n: int = len(states)
    while i < n:
        sv: int = states[i]
        if sv == 1:
            cnt = cnt + 1
        i = i + 1
    return cnt


def test_module() -> int:
    """Test circuit breaker functions."""
    passed: int = 0

    s1: int = record_success(5)
    if s1 == 0:
        passed = passed + 1

    f1: int = record_failure(3)
    if f1 == 4:
        passed = passed + 1

    st1: int = evaluate_state(2, 3, 0)
    if st1 == 0:
        passed = passed + 1

    st2: int = evaluate_state(3, 3, 0)
    if st2 == 1:
        passed = passed + 1

    states: list[int] = simulate_circuit([1, 1, 0, 0, 0, 1], 3, 2)
    if len(states) == 6:
        passed = passed + 1

    csn: int = circuit_state_name(2)
    if csn == 2:
        passed = passed + 1

    return passed
