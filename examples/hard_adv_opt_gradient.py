# Generated by: depyler corpus generator
# Source: hard_adv_opt_gradient.py
#
# Gradient descent variants for function minimization.


def quadratic_eval(coeffs: list[float], x_val: float) -> float:
    """Evaluate polynomial: coeffs[0] + coeffs[1]*x + coeffs[2]*x^2."""
    c0: float = coeffs[0]
    c1: float = coeffs[1]
    c2: float = coeffs[2]
    return c0 + c1 * x_val + c2 * x_val * x_val


def quadratic_gradient(coeffs: list[float], x_val: float) -> float:
    """Derivative of polynomial: coeffs[1] + 2*coeffs[2]*x."""
    c1: float = coeffs[1]
    c2: float = coeffs[2]
    return c1 + 2.0 * c2 * x_val


def gradient_descent(coeffs: list[float], start: float, lr: float, steps: int) -> float:
    """Run gradient descent to minimize the quadratic."""
    x_cur: float = start
    i: int = 0
    while i < steps:
        grad: float = quadratic_gradient(coeffs, x_cur)
        x_cur = x_cur - lr * grad
        i = i + 1
    return x_cur


def gradient_descent_momentum(coeffs: list[float], start: float, lr: float, momentum: float, steps: int) -> float:
    """Gradient descent with momentum."""
    x_cur: float = start
    velocity: float = 0.0
    i: int = 0
    while i < steps:
        grad: float = quadratic_gradient(coeffs, x_cur)
        velocity = momentum * velocity - lr * grad
        x_cur = x_cur + velocity
        i = i + 1
    return x_cur


def line_search_min(coeffs: list[float], x_start: float, direction: float, max_step: float) -> float:
    """Simple line search along a direction to find minimum."""
    best_x: float = x_start
    best_val: float = quadratic_eval(coeffs, x_start)
    step: float = 0.0
    while step <= max_step:
        candidate: float = x_start + step * direction
        val: float = quadratic_eval(coeffs, candidate)
        if val < best_val:
            best_val = val
            best_x = candidate
        step = step + 0.1
    return best_x


def abs_float(x_val: float) -> float:
    """Absolute value for float."""
    if x_val < 0.0:
        return 0.0 - x_val
    return x_val


def test_module() -> int:
    """Test gradient descent functions."""
    passed: int = 0

    coeffs: list[float] = [5.0, 0.0 - 4.0, 1.0]
    val_at_2: float = quadratic_eval(coeffs, 2.0)
    if abs_float(val_at_2 - 1.0) < 0.01:
        passed = passed + 1

    grad_at_0: float = quadratic_gradient(coeffs, 0.0)
    if abs_float(grad_at_0 - (0.0 - 4.0)) < 0.01:
        passed = passed + 1

    result: float = gradient_descent(coeffs, 10.0, 0.1, 100)
    if abs_float(result - 2.0) < 0.5:
        passed = passed + 1

    result2: float = gradient_descent_momentum(coeffs, 10.0, 0.05, 0.9, 200)
    if abs_float(result2 - 2.0) < 1.0:
        passed = passed + 1

    ls: float = line_search_min(coeffs, 0.0, 1.0, 5.0)
    if abs_float(ls - 2.0) < 0.5:
        passed = passed + 1

    return passed
