# Generated by: depyler corpus generator
# Source: hard_adv_net_loadbalance.py
#
# Load balancer algorithms: round robin, weighted, least connections.


def round_robin(current: int, num_servers: int) -> int:
    """Simple round-robin selection."""
    return (current + 1) % num_servers


def weighted_select(weights: list[int], counter: int) -> int:
    """Weighted round-robin: select server based on cumulative weights."""
    total: int = 0
    i: int = 0
    n: int = len(weights)
    while i < n:
        w: int = weights[i]
        total = total + w
        i = i + 1
    pos: int = counter % total
    cumulative: int = 0
    j: int = 0
    while j < n:
        wj: int = weights[j]
        cumulative = cumulative + wj
        if pos < cumulative:
            return j
        j = j + 1
    return n - 1


def least_connections(connections: list[int]) -> int:
    """Select server with fewest active connections."""
    best: int = 0
    best_cnt: int = connections[0]
    i: int = 1
    n: int = len(connections)
    while i < n:
        ci: int = connections[i]
        if ci < best_cnt:
            best_cnt = ci
            best = i
        i = i + 1
    return best


def add_connection(connections: list[int], server_idx: int) -> list[int]:
    """Increment connection count for a server."""
    old: int = connections[server_idx]
    connections[server_idx] = old + 1
    return connections


def remove_connection(connections: list[int], server_idx: int) -> list[int]:
    """Decrement connection count for a server."""
    old: int = connections[server_idx]
    if old > 0:
        connections[server_idx] = old - 1
    return connections


def hash_balance(request_id: int, num_servers: int) -> int:
    """Consistent hash-based balancing."""
    h: int = (request_id * 2654435) % 1000000007
    return h % num_servers


def simulate_requests(num_requests: int, num_servers: int) -> list[int]:
    """Simulate round-robin distribution. Returns request counts per server."""
    counts: list[int] = []
    i: int = 0
    while i < num_servers:
        counts.append(0)
        i = i + 1
    current: int = -1
    j: int = 0
    while j < num_requests:
        current = round_robin(current, num_servers)
        old_cnt: int = counts[current]
        counts[current] = old_cnt + 1
        j = j + 1
    return counts


def test_module() -> int:
    """Test load balancer functions."""
    passed: int = 0

    rr: int = round_robin(0, 3)
    if rr == 1:
        passed = passed + 1

    rr2: int = round_robin(2, 3)
    if rr2 == 0:
        passed = passed + 1

    ws: int = weighted_select([3, 1, 1], 0)
    if ws == 0:
        passed = passed + 1

    lc: int = least_connections([5, 2, 8])
    if lc == 1:
        passed = passed + 1

    hb: int = hash_balance(42, 4)
    if hb >= 0 and hb < 4:
        passed = passed + 1

    sim: list[int] = simulate_requests(9, 3)
    s0: int = sim[0]
    s1: int = sim[1]
    s2: int = sim[2]
    if s0 == 3 and s1 == 3 and s2 == 3:
        passed = passed + 1

    return passed
